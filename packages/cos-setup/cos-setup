#!/bin/sh
set -e

STAGE="${1:-boot}"
set -- $(cat /proc/cmdline)
for x in "$@"; do
    case "$x" in
        cos.setup=*)
        yip -s "$STAGE" "${x#yip=}"
        ;;
    esac
done

for dir in "/oem/" "/usr/local/cloud-config/"; do
    if [ -d "$dir" ]; then
        yip -s "$STAGE" "$dir"
    fi
done